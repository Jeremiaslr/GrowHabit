<div class="profile-page">
  <app-navbar></app-navbar>

  <main class="profile-container">
    <section class="profile-hero card">
      <div class="avatar">
        <span>{{ userInitials() }}</span>
      </div>

      <div class="hero-details">
        <p class="eyebrow">Resumen personal</p>
        <h1>Hola, {{ userName() }} üëã</h1>
        <p class="subtitle">
          {{ hasHabits() ? 'Este es tu espacio para seguir creciendo.' : 'A√∫n no registras h√°bitos. ¬°Es un gran momento para comenzar!' }}
        </p>

        <div class="meta">
          <div>
            <span class="label">Miembro desde</span>
            <strong>{{ formatDate(memberSince()) }}</strong>
          </div>
          <div>
            <span class="label">Racha actual</span>
            <strong>{{ currentStreak() }} d√≠a{{ currentStreak() === 1 ? '' : 's' }}</strong>
          </div>
          <div>
            <span class="label">Mejor racha</span>
            <strong>{{ longestStreak() }} d√≠a{{ longestStreak() === 1 ? '' : 's' }}</strong>
          </div>
        </div>
      </div>

      <div class="hero-actions">
        <button type="button" class="btn primary" (click)="navigateToNewHabit()">
          Registrar h√°bito
        </button>
        <button type="button" class="btn ghost" (click)="navigateToEditProfile()">
          Editar perfil
        </button>
        <button type="button" class="btn ghost" (click)="navigateToCalendar()">
          Ver calendario
        </button>
        <button type="button" class="btn link" (click)="navigateToHabits()">
          Volver al tablero
        </button>
      </div>
    </section>

    <section class="stats-grid">
      <article class="stat-card card highlight">
        <p class="label">H√°bitos totales</p>
        <h2>{{ totalHabits() }}</h2>
        <p class="detail">
          {{ totalHabits() === 0 ? 'Sin h√°bitos registrados a√∫n' : 'Tu colecci√≥n personal de h√°bitos activos' }}
        </p>
      </article>

      <article class="stat-card card">
        <div class="stat-top">
          <p class="label">Completados hoy</p>
          <span class="badge success">{{ completionRate() }}%</span>
        </div>
        <h2>{{ completedToday() }}</h2>
        <p class="detail">H√°bitos marcados como listos</p>
        <div class="progress-bar">
          <div class="progress" [style.width.%]="completionRate()"></div>
        </div>
      </article>

      <article class="stat-card card">
        <div class="stat-top">
          <p class="label">Pendientes</p>
          <span class="badge warning">{{ pendingHabits() }}</span>
        </div>
        <h2>{{ pendingHabits() }}</h2>
        <p class="detail">
          {{ pendingHabits() === 0 ? 'Todo al d√≠a, gran trabajo' : 'H√°bitos que a√∫n puedes completar hoy' }}
        </p>
      </article>
    </section>

    <section class="activity-grid">
      <article class="card activity-card">
        <header>
          <div>
            <p class="eyebrow">Seguimiento</p>
            <h3>Actividad reciente</h3>
          </div>
          <button type="button" class="mini-btn" (click)="navigateToHabits()">
            Ver todo
          </button>
        </header>

        @if (recentActivity().length === 0) {
          <div class="empty-state">
            <p>A√∫n no hay actividad registrada.</p>
            <small>Cuando completes h√°bitos ver√°s el historial aqu√≠.</small>
          </div>
        } @else {
          <ul class="timeline">
            @for (activity of recentActivity(); track $index) {
              <li>
                <div class="dot"></div>
                <div>
                  <strong>{{ activity.habitName }}</strong>
                  <p class="detail">
                    {{ activity.category || 'General' }} ‚Ä¢ {{ formatActivityDate(activity.date) }}
                  </p>
                  @if (activity.description) {
                    <p class="description">
                      {{ activity.description }}
                    </p>
                  }
                </div>
              </li>
            }
          </ul>
        }
      </article>

      <article class="card activity-card">
        <header>
          <div>
            <p class="eyebrow">Preferencias</p>
            <h3>Categor√≠as favoritas</h3>
          </div>
        </header>

        @if (categoryStats().length === 0) {
          <div class="empty-state">
            <p>No hay categor√≠as todav√≠a.</p>
            <small>Asigna una categor√≠a al crear o editar tus h√°bitos.</small>
          </div>
        } @else {
          <ul class="categories">
            @for (category of categoryStats(); track category.category) {
              <li>
                <div>
                  <strong>{{ category.category }}</strong>
                  <p class="detail">{{ category.count }} h√°bito{{ category.count === 1 ? '' : 's' }}</p>
                </div>
                <div class="pill">
                  {{ category.percentage }}%
                </div>
              </li>
            }
          </ul>
        }
      </article>

      <article class="card suggestion-card">
        <header>
          <div>
            <p class="eyebrow">Siguiente paso</p>
            <h3>Recomendaci√≥n</h3>
          </div>
        </header>

        @if (!hasHabits()) {
          <p class="detail mb-4">
            Crea tu primer h√°bito para comenzar a construir tu rutina ideal.
          </p>
          <button class="btn primary w-full" type="button" (click)="navigateToNewHabit()">
            Crear h√°bito ahora
          </button>
        } @else if (pendingHabits() > 0) {
          <p class="detail mb-4">
            A√∫n tienes {{ pendingHabits() }} h√°bito{{ pendingHabits() === 1 ? '' : 's' }} por completar hoy. ¬°Ve por ellos!
          </p>
          <button class="btn ghost w-full" type="button" (click)="navigateToHabits()">
            Abrir tablero
          </button>
        } @else {
          <p class="detail mb-4">
            ¬°Todo completado! Revisa el calendario para ver tu progreso a largo plazo.
          </p>
          <button class="btn ghost w-full" type="button" (click)="navigateToCalendar()">
            Ir al calendario
          </button>
        }
      </article>
    </section>
  </main>
</div>


